{"version":3,"sources":["../../../../../src/visualBuilder/components/FieldRevert/FieldRevertComponent.tsx"],"sourcesContent":["import classNames from \"classnames\";\nimport React, { useRef, useEffect } from \"preact/compat\";\nimport { visualBuilderStyles } from \"../../visualBuilder.style\";\nimport visualBuilderPostMessage from \"../../utils/visualBuilderPostMessage\";\nimport { CslpData } from \"../../../cslp/types/cslp.types\";\n\nexport interface IVariantStatus {\n    fieldLevelCustomizations: boolean;\n    isBaseModified: boolean;\n    isAddedInstances: boolean;\n    isDeletedInstances: boolean;\n    isOrderChanged: boolean;\n}\n\nexport type TFieldRevertActionCallback =\n    | \"revert_to_base_entry_value\"\n    | \"revert_added_instances\"\n    | \"restore_deleted_instances\"\n    | \"reset_field_level_customizations\"\n    | \"restore_sorted_instances\";\n\ninterface FieldRevertComponentProps {\n    fieldDataName: string;\n    fieldMetadata: CslpData;\n    isOpen: boolean;\n    closeDropdown: () => void;\n    variantStatus?: IVariantStatus;\n}\n\ninterface IItem {\n    label: string;\n    action: TFieldRevertActionCallback;\n    id: string;\n    testId: string;\n    fieldDataName: string;\n}\n\nexport const BASE_VARIANT_STATUS: IVariantStatus = {\n    isAddedInstances: false,\n    isBaseModified: false,\n    isDeletedInstances: false,\n    isOrderChanged: false,\n    fieldLevelCustomizations: false,\n};\n\nexport async function getFieldVariantStatus(\n    fieldPathWithIndex: string\n): Promise<IVariantStatus | undefined> {\n    try {\n        const result = await visualBuilderPostMessage?.send<IVariantStatus>(\n            \"get-field-variant-status\",\n            fieldPathWithIndex\n        );\n        return result;\n    } catch (error) {\n        console.error(\"Failed to get field variant status:\", error);\n    }\n}\n\nexport const FieldRevertComponent = (props: FieldRevertComponentProps) => {\n    const {\n        fieldDataName,\n        fieldMetadata,\n        variantStatus = BASE_VARIANT_STATUS,\n        isOpen,\n        closeDropdown,\n    } = props;\n    const dropdownRef = useRef<HTMLDivElement>(null);\n\n    useEffect(() => {\n        const handleClickOutside = (event: MouseEvent) => {\n            if (\n                dropdownRef.current &&\n                !dropdownRef.current.contains(event.target as Node)\n            ) {\n                closeDropdown();\n            }\n        };\n\n        document.addEventListener(\"mousedown\", handleClickOutside);\n        return () => {\n            document.removeEventListener(\"mousedown\", handleClickOutside);\n        };\n    }, []);\n\n    const getDropdownItems = () => {\n        const {\n            isAddedInstances,\n            isDeletedInstances,\n            isBaseModified,\n            isOrderChanged,\n            fieldLevelCustomizations,\n        } = variantStatus;\n\n        const dropdownItems: IItem[] = [];\n\n        if (isBaseModified) {\n            dropdownItems.push({\n                label: \"Revert to base entry value\",\n                action: \"revert_to_base_entry_value\",\n                id: `iframe-cs-variant-field-${fieldDataName}-revert`,\n                testId: `iframe-cs-variant-field-${fieldDataName}-revert`,\n                fieldDataName,\n            });\n        }\n\n        if (isAddedInstances) {\n            dropdownItems.push({\n                label: \"Revert added instances\",\n                action: \"revert_added_instances\",\n                id: `iframe-cs-variant-field-${fieldDataName}-revert-added-instances`,\n                testId: `iframe-cs-variant-field-${fieldDataName}-revert-added-instances`,\n                fieldDataName,\n            });\n        }\n\n        if (isDeletedInstances) {\n            dropdownItems.push({\n                label: \"Restore deleted instances\",\n                action: \"restore_deleted_instances\",\n                id: `iframe-cs-variant-field-${fieldDataName}-restore-deleted-instances`,\n                testId: `iframe-cs-variant-field-${fieldDataName}-restore-deleted-instances`,\n                fieldDataName,\n            });\n        }\n\n        if (fieldLevelCustomizations) {\n            dropdownItems.push({\n                label: \"Reset field-level customizations\",\n                action: \"reset_field_level_customizations\",\n                id: `iframe-cs-variant-field-${fieldDataName}-reset-field-level-customizations`,\n                testId: `iframe-cs-variant-field-${fieldDataName}-reset-field-level-customizations`,\n                fieldDataName,\n            });\n        }\n\n        if (isOrderChanged) {\n            dropdownItems.push({\n                label: \"Restore sorted instances\",\n                action: \"restore_sorted_instances\",\n                id: `iframe-cs-variant-field-${fieldDataName}-restore-sorted-instances`,\n                testId: `iframe-cs-variant-field-${fieldDataName}-restore-sorted-instances`,\n                fieldDataName,\n            });\n        }\n\n        return dropdownItems;\n    };\n\n    const dropdownItems = getDropdownItems();\n\n    function handleOnClick(item: IItem) {\n        const { fieldDataName, action } = item;\n        visualBuilderPostMessage?.send(\"send-variant-revert-action-trigger\", {\n            fieldDataName,\n            action,\n            euid: fieldMetadata.entry_uid,\n            ct_uid: fieldMetadata.content_type_uid,\n            locale: fieldMetadata.locale,\n        });\n    }\n\n    return (\n        <div\n            className={classNames(\n                \"variant-field-revert-component\",\n                visualBuilderStyles()[\"variant-field-revert-component\"]\n            )}\n            ref={dropdownRef}\n            onClick={(e) => e.stopPropagation()}\n        >\n            {isOpen && (\n                <div\n                    className={classNames(\n                        \"variant-field-revert-component__dropdown-content\",\n                        visualBuilderStyles()[\n                            \"variant-field-revert-component__dropdown-content\"\n                        ]\n                    )}\n                >\n                    {dropdownItems.map((item) => (\n                        <div\n                            className={classNames(\n                                \"variant-field-revert-component__dropdown-content__list-item\",\n                                visualBuilderStyles()[\n                                    \"variant-field-revert-component__dropdown-content__list-item\"\n                                ]\n                            )}\n                            onClick={(e) => {\n                                e.preventDefault();\n                                handleOnClick(item);\n                                closeDropdown();\n                            }}\n                            key={item.id}\n                            data-testid={item.testId}\n                        >\n                            <span>{item.label}</span>\n                        </div>\n                    ))}\n                </div>\n            )}\n        </div>\n    );\n};\n"],"mappings":"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","names":["visualBuilderPostMessage","dropdownItems","fieldDataName","classNames"]}