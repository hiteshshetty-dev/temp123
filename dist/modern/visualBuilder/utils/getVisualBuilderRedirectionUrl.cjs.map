{"version":3,"sources":["../../../../src/visualBuilder/utils/getVisualBuilderRedirectionUrl.ts"],"sourcesContent":["import Config from \"../../configManager/configManager\";\nimport { extractDetailsFromCslp } from \"../../cslp\";\n\n/**\n * Returns the redirection URL for the Visual builder.\n * @returns {URL} The redirection URL.\n */\nexport default function getVisualBuilderRedirectionUrl(): URL {\n    const { stackDetails, clientUrlParams } = Config.get();\n    const { branch, apiKey, environment, locale } = stackDetails;\n    const { url: appUrl } = clientUrlParams;\n\n    const searchParams = new URLSearchParams();\n    if (branch) {\n        searchParams.set(\"branch\", branch);\n    }\n    if (environment) {\n        searchParams.set(\"environment\", environment);\n    }\n\n    searchParams.set(\"target-url\", window.location.href);\n\n    // get the locale from the data cslp attribute\n    const elementWithDataCslp = document.querySelector(`[data-cslp]`);\n    let localeToUse = locale;\n\n    if (elementWithDataCslp) {\n        const cslpData = elementWithDataCslp.getAttribute(\"data-cslp\");\n        if (cslpData) {\n            const { locale: cslpLocale } = extractDetailsFromCslp(cslpData);\n            localeToUse = cslpLocale;\n        }\n    }\n\n    if (localeToUse) {\n        searchParams.set(\"locale\", localeToUse);\n    }\n\n    const completeURL = new URL(\n        `/#!/stack/${apiKey}/visual-builder?${searchParams.toString()}`,\n        appUrl\n    );\n    return completeURL;\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAAmB;AACnB,kBAAuC;AAMxB,SAAR,iCAAuD;AAC1D,QAAM,EAAE,cAAc,gBAAgB,IAAI,qBAAAA,QAAO,IAAI;AACrD,QAAM,EAAE,QAAQ,QAAQ,aAAa,OAAO,IAAI;AAChD,QAAM,EAAE,KAAK,OAAO,IAAI;AAExB,QAAM,eAAe,IAAI,gBAAgB;AACzC,MAAI,QAAQ;AACR,iBAAa,IAAI,UAAU,MAAM;AAAA,EACrC;AACA,MAAI,aAAa;AACb,iBAAa,IAAI,eAAe,WAAW;AAAA,EAC/C;AAEA,eAAa,IAAI,cAAc,OAAO,SAAS,IAAI;AAGnD,QAAM,sBAAsB,SAAS,cAAc,aAAa;AAChE,MAAI,cAAc;AAElB,MAAI,qBAAqB;AACrB,UAAM,WAAW,oBAAoB,aAAa,WAAW;AAC7D,QAAI,UAAU;AACV,YAAM,EAAE,QAAQ,WAAW,QAAI,oCAAuB,QAAQ;AAC9D,oBAAc;AAAA,IAClB;AAAA,EACJ;AAEA,MAAI,aAAa;AACb,iBAAa,IAAI,UAAU,WAAW;AAAA,EAC1C;AAEA,QAAM,cAAc,IAAI;AAAA,IACpB,aAAa,MAAM,mBAAmB,aAAa,SAAS,CAAC;AAAA,IAC7D;AAAA,EACJ;AACA,SAAO;AACX;","names":["Config"]}