{"version":3,"sources":["../../../../src/visualBuilder/eventManager/useVariantsPostMessageEvent.ts"],"sourcesContent":["import { VisualBuilder } from \"..\";\nimport { visualBuilderStyles } from \"../visualBuilder.style\";\nimport visualBuilderPostMessage from \"../utils/visualBuilderPostMessage\";\nimport { VisualBuilderPostMessageEvents } from \"../utils/types/postMessage.types\";\n\ninterface VariantFieldsEvent {\n    data: {\n        variant_data: {\n            variant: string;\n            highlightVariantFields: boolean;\n        };\n    };\n}\n\ninterface AudienceEvent {\n    data: {\n        audienceMode: boolean;\n    };\n}\ninterface VariantEvent {\n    data: {\n        variant: string | null;\n    };\n}\n\ninterface LocaleEvent {\n    data: {\n        locale: string;\n    };\n}\nfunction addVariantFieldClass(\n    variant_uid: string,\n    highlightVariantFields: boolean\n): void {\n    const elements = document.querySelectorAll(`[data-cslp]`);\n    elements.forEach((element) => {\n        const dataCslp = element.getAttribute(\"data-cslp\");\n        if (!dataCslp) return;\n\n        if (dataCslp?.includes(variant_uid)) {\n            highlightVariantFields &&\n                element.classList.add(\n                    visualBuilderStyles()[\"visual-builder__variant-field\"]\n                );\n            element.classList.add(\"visual-builder__variant-field\");\n        } else if (!dataCslp.startsWith(\"v2:\")) {\n            element.classList.add(\"visual-builder__base-field\");\n        } else {\n            element.classList.add(\"visual-builder__disabled-variant-field\");\n        }\n    });\n}\n\nfunction removeVariantFieldClass(): void {\n    const variantAndBaseFieldElements = document.querySelectorAll(\n        \".visual-builder__disabled-variant-field, .visual-builder__variant-field, .visual-builder__base-field\"\n    );\n    variantAndBaseFieldElements.forEach((element) => {\n        element.classList.remove(\n            \"visual-builder__disabled-variant-field\",\n            \"visual-builder__variant-field\",\n            visualBuilderStyles()[\"visual-builder__variant-field\"],\n            \"visual-builder__base-field\"\n        );\n    });\n}\n\nfunction setAudienceMode(mode: boolean): void {\n    VisualBuilder.VisualBuilderGlobalState.value.audienceMode = mode;\n}\nfunction setVariant(uid: string | null): void {\n    VisualBuilder.VisualBuilderGlobalState.value.variant = uid;\n}\nfunction setLocale(locale: string): void {\n    VisualBuilder.VisualBuilderGlobalState.value.locale = locale;\n}\n\nexport function useVariantFieldsPostMessageEvent(): void {\n    visualBuilderPostMessage?.on(\n        VisualBuilderPostMessageEvents.GET_VARIANT_ID,\n        (event: VariantEvent) => {\n            setVariant(event.data.variant);\n        }\n    );\n    visualBuilderPostMessage?.on(\n        VisualBuilderPostMessageEvents.GET_LOCALE,\n        (event: LocaleEvent) => {\n            setLocale(event.data.locale);\n        }\n    );\n    visualBuilderPostMessage?.on(\n        VisualBuilderPostMessageEvents.SET_AUDIENCE_MODE,\n        (event: AudienceEvent) => {\n            setAudienceMode(event.data.audienceMode);\n        }\n    );\n    visualBuilderPostMessage?.on(\n        VisualBuilderPostMessageEvents.SHOW_VARIANT_FIELDS,\n        (event: VariantFieldsEvent) => {\n            removeVariantFieldClass();\n            addVariantFieldClass(\n                event.data.variant_data.variant,\n                event.data.variant_data.highlightVariantFields\n            );\n        }\n    );\n    visualBuilderPostMessage?.on(\n        VisualBuilderPostMessageEvents.REMOVE_VARIANT_FIELDS,\n        () => {\n            removeVariantFieldClass();\n        }\n    );\n}\n"],"mappings":";;;AAAA,SAAS,qBAAqB;AAC9B,SAAS,2BAA2B;AACpC,OAAO,8BAA8B;AACrC,SAAS,sCAAsC;AA2B/C,SAAS,qBACL,aACA,wBACI;AACJ,QAAM,WAAW,SAAS,iBAAiB,aAAa;AACxD,WAAS,QAAQ,CAAC,YAAY;AAC1B,UAAM,WAAW,QAAQ,aAAa,WAAW;AACjD,QAAI,CAAC,SAAU;AAEf,QAAI,qCAAU,SAAS,cAAc;AACjC,gCACI,QAAQ,UAAU;AAAA,QACd,oBAAoB,EAAE,+BAA+B;AAAA,MACzD;AACJ,cAAQ,UAAU,IAAI,+BAA+B;AAAA,IACzD,WAAW,CAAC,SAAS,WAAW,KAAK,GAAG;AACpC,cAAQ,UAAU,IAAI,4BAA4B;AAAA,IACtD,OAAO;AACH,cAAQ,UAAU,IAAI,wCAAwC;AAAA,IAClE;AAAA,EACJ,CAAC;AACL;AAEA,SAAS,0BAAgC;AACrC,QAAM,8BAA8B,SAAS;AAAA,IACzC;AAAA,EACJ;AACA,8BAA4B,QAAQ,CAAC,YAAY;AAC7C,YAAQ,UAAU;AAAA,MACd;AAAA,MACA;AAAA,MACA,oBAAoB,EAAE,+BAA+B;AAAA,MACrD;AAAA,IACJ;AAAA,EACJ,CAAC;AACL;AAEA,SAAS,gBAAgB,MAAqB;AAC1C,gBAAc,yBAAyB,MAAM,eAAe;AAChE;AACA,SAAS,WAAW,KAA0B;AAC1C,gBAAc,yBAAyB,MAAM,UAAU;AAC3D;AACA,SAAS,UAAU,QAAsB;AACrC,gBAAc,yBAAyB,MAAM,SAAS;AAC1D;AAEO,SAAS,mCAAyC;AA7EzD;AA8EI,wDAA0B;AAAA,IACtB,+BAA+B;AAAA,IAC/B,CAAC,UAAwB;AACrB,iBAAW,MAAM,KAAK,OAAO;AAAA,IACjC;AAAA;AAEJ,wDAA0B;AAAA,IACtB,+BAA+B;AAAA,IAC/B,CAAC,UAAuB;AACpB,gBAAU,MAAM,KAAK,MAAM;AAAA,IAC/B;AAAA;AAEJ,wDAA0B;AAAA,IACtB,+BAA+B;AAAA,IAC/B,CAAC,UAAyB;AACtB,sBAAgB,MAAM,KAAK,YAAY;AAAA,IAC3C;AAAA;AAEJ,wDAA0B;AAAA,IACtB,+BAA+B;AAAA,IAC/B,CAAC,UAA8B;AAC3B,8BAAwB;AACxB;AAAA,QACI,MAAM,KAAK,aAAa;AAAA,QACxB,MAAM,KAAK,aAAa;AAAA,MAC5B;AAAA,IACJ;AAAA;AAEJ,wDAA0B;AAAA,IACtB,+BAA+B;AAAA,IAC/B,MAAM;AACF,8BAAwB;AAAA,IAC5B;AAAA;AAER;","names":[]}